<!-- templates/auction/lot_detail.html -->
{% extends 'base.html' %}

{% block content %}
<h1>{{ lot.title }}</h1>
<div class="row">
    <div class="col-md-6">
        {% if lot.main_image %}
        <img src="{{ lot.main_image.url }}" class="img-fluid" alt="{{ lot.title }}">
        {% endif %}
        <div class="row">
            {% if lot.additional_image_1 %}
            <div class="col-md-4"><img src="{{ lot.additional_image_1.url }}" class="img-fluid"
                    alt="Доп. изображение 1"></div>
            {% endif %}
            {% if lot.additional_image_2 %}
            <div class="col-md-4"><img src="{{ lot.additional_image_2.url }}" class="img-fluid"
                    alt="Доп. изображение 2"></div>
            {% endif %}
            {% if lot.additional_image_3 %}
            <div class="col-md-4"><img src="{{ lot.additional_image_3.url }}" class="img-fluid"
                    alt="Доп. изображение 3"></div>
            {% endif %}
        </div>
    </div>
    <div class="col-md-6">
        {% if not lot.is_auction_ended %}
        <p>Время до окончания: {{ lot.auction_end|timeuntil }}</p>
        {% endif %}
        <p>Автор: {{ lot.created_by.username }}</p>
        <p>Начальная цена: {{ lot.initial_price }}</p>
        <p>Текущая ставка: {{ lot.current_price|default:"Нет ставок" }}</p>
        {% if recent_bidders %}
        <p>Последние участники:</p>
        <ul>
            {% for bid in recent_bidders %}
            <li>{{ bid.user.username }} (ставка: {{ bid.amount }})</li>
            {% endfor %}
        </ul>
        {% endif %}
        {% if user.is_authenticated and not lot.is_auction_ended %}
        {% if is_author %}
        <p>Вы не можете делать ставки на свой лот.</p>
        {% else %}
        <form method="post">
            {% csrf_token %}
            {{ bid_form }}
            <button type="submit" name="bid" class="btn btn-success">Сделать ставку</button>
        </form>
        {% endif %}
        {% elif lot.is_auction_ended %}
        <p>Аукцион завершен.</p>
        {% else %}
        <p><a href="{% url 'login' %}">Авторизуйтесь</a>, чтобы сделать ставку.</p>
        {% endif %}
    </div>
</div>

<h2>Описание</h2>
<p>{{ lot.description }}</p>

<h2>Комментарии</h2>
{% if user.is_authenticated and not lot.is_auction_ended %}
<form method="post">
    {% csrf_token %}
    {{ comment_form }}
    <button type="submit" name="comment" class="btn btn-primary">Добавить комментарий</button>
</form>
{% elif lot.is_auction_ended %}
<p>Комментарии нельзя оставлять после завершения аукциона.</p>
{% else %}
<p><a href="{% url 'login' %}">Авторизуйтесь</a>, чтобы оставить комментарий.</p>
{% endif %}
{% for comment in lot.comments.all %}
<div class="card mt-2">
    <div class="card-body">
        <p>{{ comment.content }}</p>
        <p>Автор: {{ comment.user.username }} | {{ comment.created_at }}</p>
    </div>
</div>
{% empty %}
<p>Комментариев пока нет.</p>
{% endfor %}
{% endblock %}